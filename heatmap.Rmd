---
title: "NHL Goalie and Skater Heat Maps"
author: "Sasank Vishnubhatla"
date: "January 10, 2019"
html_document:
  runtime: shiny
  theme: simplex 
  df_print: paged
  dev: 'svg'
pdf_document:
  df_print: kable
  toc: true
---

```{r global_options, include=FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE)
```

Last Update: `r Sys.time()`

GitHub Repository: [sv4u/goalie-and-skater-heat-maps](https://github.com/sv4u/goalie-and-skater-heat-maps)

# Introduction

In the NHL, players have their *sweet-spots*. For skaters, it can be the top of a certain circle, or right in-front of the net. For goalies, it could be where their vision is best and where they have the best angle to cut down a shot. All players have these sweet-spots, but it is difficult to analytically say where they are. By using shot location data, we can determine these locations and create models show where goalies and skaters need improvement and where they succeed.

# Data Formatting

To start, we need to read in our data. Our data is formatted nicely in CSV format. We have data from the 2016-2017 season, 2017-2018 season, and 2018-2019 season (up to 1/7/19). This data was downloaded from [MoneyPuck](http://www.moneypuck.com). Let's first start by loading in all three seasons of data:

```{r}
data.2016 = read.csv("data/2016.csv")
data.2017 = read.csv("data/2017.csv")
data.2018 = read.csv("data/2018.csv")
```

> Note: this will take a *relatively* long time to compute as the datasets are large. Each dataset contains all shot data (**including** playoffs).

We'll only look at regular season data. The playoffs in the NHL are a beast of their own.

```{r}
get.regular.season = function(data) {
	subset(data, isPlayoffGame == 0)
}

season.2016 = get.regular.season(data.2016)
season.2017 = get.regular.season(data.2017)
season.2018 = get.regular.season(data.2018)

```

Now that we have our data, we can remove extraneous columns. Here is a table of what columns we are keeping, and what we are renaming them to:

| Old Column | New Column |
| ---------- | ---------- |
| xCordAdjusted | x |
| yCordAdjusted | y |
| goal | goal |
| shotAngleAdjusted | angle |
| goalieNameForShot | goalie_name |
| shooterName | skater_name |
| game_id | game |

Now, here is the R code to do this subsetting of the original dataset.

```{r}
get.helpful.data = function(data) {
	data.frame(x = data$xCordAdjusted,
		   y = data$yCordAdjusted,
		   goal = data$goal,
		   angle = data$shotAngleAdjusted,
		   goalie_name = data$goalieNameForShot,
		   skater_name = data$shooterName,
		   game = data$game_id)
}

analysis.2016 = get.helpful.data(season.2016)
analysis.2017 = get.helpful.data(season.2017)
analysis.2018 = get.helpful.data(season.2018)
```

Now, we have all the data we need.

# Function Definitions {.tabset .tabset-fade}

## Generic

From our data, we can calculate some very important statistics like the following:

* Goal Percent: goals per total shots
* Save Percent: saves (total shots - goals) per total shots
* Shots per Goal: total shots per goal

Additionally, we can break up our data by game. There are some generic functions we can write to help for both goalies and skaters. Let's write them now!

```{r}
get.goal.percent = function(data) {
	shots = length(data$goal)
	temp = subset(data, goal == 1)
	goals = length(temp$goal)
	goals / shots
}

get.save.percent = function(data) {
	shots = length(data$goal)
	temp = subset(data, goal == 1)
	goals = length(temp$goal)
	(shots - goals) / shots
}

get.shots.per.goal = function(data) {
	shots = length(data$goal)
	temp = subset(data, goal == 1)
	goals = length(temp$goal)
	shots / goal
}
```

> Note: when using `get.shots.per.goal`, if there were no goals scored, R will handle the division by zero by returning infinity. This will be problematic when graphing data. I am still working on a good solution to this problem. [Earlier](http://sasankvishnubhatla.net/shots_per_goal/analysis.html), I used 200 as a substitute value. However, 200 still skews graphs, which is unideal.

## Goalies

## Skaters

# Analysis {.tabset .tabset-fade}

## Goalies {.tabset .tabset-fade}

### Matt Murray

### Casey DeSmith

### Marc-Andre Fleury

### Andrei Vasilevskiy

### Carey Price

### Braden Holtby

### John Gibson

## Skaters {.tabset .tabset-fade}

### Sidney Crosby

### Evgeni Malkin

### Alex Ovechkin

### Nikita Kucherov

### Jake Guentzel

### Erik Karlsson

### Kris Letang
